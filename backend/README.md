后端结构
cs2-betting-backend/
├── .env                 # 配置文件 (存放 RPC 和合约地址)
├── .python-version      # uv 生成的版本文件
├── pyproject.toml       # uv 生成的依赖管理文件
├── uv.lock              # uv 生成的锁定文件
├── abi.json             # 合约接口文件 (复用之前的内容)
├── app.py               # 主后端代码
├── reset_db.py          # 数据库重置脚本
└── betting.db           # SQLite 数据库文件 (运行时自动生成)

## 数据同步机制

后端实现了多层次的数据同步策略，确保数据库与区块链数据100%一致：

### 1. 实时事件监听（主要同步机制）
- **NewBet事件**：监听用户下注事件，实时记录到数据库并更新统计数据
- **GameStatusChanged事件**：监听游戏状态变化，实时更新游戏状态
- **WinnerSelected事件**：监听获胜者选择，实时更新结果
- **优势**：实时性强，数据一致性高，无延迟

### 2. 定期全量同步（备用机制）
- 每60秒自动执行完整数据同步
- 确保即使事件监听器出现问题也能保持数据同步
- 可以通过 `/api/sync` API手动触发

### 3. 手动同步API
- `POST /api/sync`：手动触发完整数据同步
- 用于测试或在需要时强制同步

### 同步流程
1. 用户在前端下注 → 智能合约记录交易
2. 智能合约触发NewBet事件
3. 后端事件监听器捕获事件 → 实时更新数据库
4. 前端通过React Query自动刷新显示最新数据

这种设计确保了数据同步的实时性和可靠性。